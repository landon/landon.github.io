Bridge.assembly("TouchTest",function(){"use strict";Bridge.define("TouchTest.App",{main:function(){window.onload=Bridge.fn.combine(window.onload,TouchTest.App.OnLoad);TouchTest.App._canvas=document.createElement("canvas");TouchTest.App._canvas.className="full";document.body.appendChild(TouchTest.App._canvas)},statics:{fields:{_canvas:null,_context:null,_history:null},ctors:{init:function(){this._history=new(TouchTest.Set$1(TouchTest.TouchHistory))}},methods:{OnLoad:function(){TouchTest.App._context=TouchTest.App._canvas.getContext("2d");TouchTest.App._context.strokeStyle="#222222";TouchTest.App.AttachTouchEvents(TouchTest.App._canvas)},AttachTouchEvents:function(canvas){canvas.ontouchcancel=Bridge.fn.combine(canvas.ontouchcancel,TouchTest.App.OnTouchCancel);canvas.ontouchend=Bridge.fn.combine(canvas.ontouchend,TouchTest.App.OnTouchEnd);canvas.ontouchenter=Bridge.fn.combine(canvas.ontouchenter,TouchTest.App.OnTouchEnter);canvas.ontouchleave=Bridge.fn.combine(canvas.ontouchleave,TouchTest.App.OnTouchLeave);canvas.ontouchmove=Bridge.fn.combine(canvas.ontouchmove,TouchTest.App.OnTouchMove);canvas.ontouchstart=Bridge.fn.combine(canvas.ontouchstart,TouchTest.App.OnTouchStart)},OnTouchCancel:function(e){var $t,t;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,TouchTest.App._history.Remove(t.identifier)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchEnd:function(e){var $t,t;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,TouchTest.App._history.Remove(t.identifier)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchEnter:function(e){e.preventDefault()},OnTouchLeave:function(e){e.preventDefault()},OnTouchMove:function(e){var $t,t,th;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,th=TouchTest.App._history.Find(t.identifier),th!=null&&th.AddEvent(t)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchStart:function(e){var $t,$t1,t,th;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,th=($t1=new TouchTest.TouchHistory,$t1.Id=t.identifier,$t1),th.AddEvent(t),TouchTest.App._history.Add(th)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},Redraw:function(){var $t,h;TouchTest.App._context.clearRect(0,0,TouchTest.App._canvas.width,TouchTest.App._canvas.height);$t=Bridge.getEnumerator(TouchTest.App._history);try{while($t.moveNext())h=$t.Current,h.Draw(TouchTest.App._context)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}}}});Bridge.define("TouchTest.Item",{props:{Id:0,Dead:!1}});Bridge.define("TouchTest.TouchHistory.Point",{props:{Time:null,ClientX:0,ClientY:0,PageX:0,PageY:0,ScreenX:0,ScreenY:0,RadiusX:0,RadiusY:0,Force:0,RotationAngle:0},ctors:{init:function(){this.Time=System.DateTime.getDefaultValue()},ctor:function(time,t){this.$initialize();this.Time=time;this.ClientX=t.clientX;this.ClientY=t.clientY;this.PageX=t.pageX;this.PageY=t.pageY;this.ScreenX=t.screenX;this.ScreenY=t.screenY;this.RadiusX=t.radiusX;this.RadiusY=t.radiusY;this.Force=t.force;this.RotationAngle=t.rotationAngle}}});Bridge.define("TouchTest.Set$1",function(T){return{inherits:[System.Collections.Generic.IEnumerable$1(T)],fields:{_items:null},alias:["getEnumerator",["System$Collections$Generic$IEnumerable$1$"+Bridge.getTypeAlias(T)+"$getEnumerator","System$Collections$Generic$IEnumerable$1$getEnumerator"]],ctors:{init:function(){this._items=new(System.Collections.Generic.List$1(T))}},methods:{getEnumerator:function(){return this._items.getEnumerator()},System$Collections$IEnumerable$getEnumerator:function(){return Bridge.getEnumerator(Bridge.cast(this,System.Collections.Generic.IEnumerable$1(T)),T)},Remove:function(i){var t=this.Find(i);t!=null&&this._items.remove(t)},Find:function(i){return System.Linq.Enumerable.from(this._items).firstOrDefault(function(x){return x.Id===i},Bridge.getDefaultValue(T))},Add:function(t){this.Has(t.Id)||this._items.add(t)},Has:function(i){return this.Find(i)!=null}}}});Bridge.define("TouchTest.TouchHistory",{inherits:[TouchTest.Item],fields:{_events:null},ctors:{init:function(){this._events=new(System.Collections.Generic.List$1(TouchTest.TouchHistory.Point))}},methods:{AddEvent:function(t){var now=System.DateTime.getNow();this._events.add(new TouchTest.TouchHistory.Point(now,t))},Draw:function(context){var $t,first,b;if(this._events.Count>1){context.beginPath();first=!0;$t=Bridge.getEnumerator(this._events);try{while($t.moveNext())b=$t.Current,first?(context.moveTo(b.ClientX,b.ClientY),first=!1):context.lineTo(b.ClientX,b.ClientY)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}context.stroke()}}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJUb3VjaFRlc3QubWluLmpzIiwKICAic291cmNlUm9vdCI6ICIiLAogICJzb3VyY2VzIjogW10sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIiIsCiAgInNvdXJjZXNDb250ZW50IjogW10KfQo=
