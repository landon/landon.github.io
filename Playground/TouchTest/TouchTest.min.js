Bridge.assembly("TouchTest",function(){"use strict";Bridge.define("TouchTest.App",{main:function(){window.onload=Bridge.fn.combine(window.onload,TouchTest.App.OnLoad);TouchTest.App._canvas=document.createElement("canvas");TouchTest.App._canvas.className="full";document.body.appendChild(TouchTest.App._canvas)},statics:{fields:{_canvas:null,_context:null,_history:null},ctors:{init:function(){this._history=new(TouchTest.Set$1(TouchTest.TouchHistory))(256)}},methods:{OnLoad:function(){TouchTest.App._context=TouchTest.App._canvas.getContext("2d");TouchTest.App._context.strokeStyle="#222222";TouchTest.App.AttachTouchEvents(TouchTest.App._canvas)},AttachTouchEvents:function(canvas){canvas.ontouchcancel=Bridge.fn.combine(canvas.ontouchcancel,TouchTest.App.OnTouchCancel);canvas.ontouchend=Bridge.fn.combine(canvas.ontouchend,TouchTest.App.OnTouchEnd);canvas.ontouchenter=Bridge.fn.combine(canvas.ontouchenter,TouchTest.App.OnTouchEnter);canvas.ontouchleave=Bridge.fn.combine(canvas.ontouchleave,TouchTest.App.OnTouchLeave);canvas.ontouchmove=Bridge.fn.combine(canvas.ontouchmove,TouchTest.App.OnTouchMove);canvas.ontouchstart=Bridge.fn.combine(canvas.ontouchstart,TouchTest.App.OnTouchStart)},OnTouchCancel:function(e){var $t,t;e.preventDefault();System.Console.WriteLine("cancel");$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,TouchTest.App._history.Remove(t.identifier)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchEnd:function(e){var $t,t;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,TouchTest.App._history.Remove(t.identifier)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchEnter:function(e){e.preventDefault()},OnTouchLeave:function(e){e.preventDefault()},OnTouchMove:function(e){var $t,t,th;e.preventDefault();$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,th=TouchTest.App._history.Find(t.identifier),th!=null&&th.AddEvent(t)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},OnTouchStart:function(e){var $t,$t1,t,th;e.preventDefault();System.Console.WriteLine("touch");$t=Bridge.getEnumerator(e.changedTouches);try{while($t.moveNext())t=$t.Current,TouchTest.App._history.Contains(t.identifier)||(th=($t1=new TouchTest.TouchHistory,$t1.Id=t.identifier,$t1),th.AddEvent(t),TouchTest.App._history.Add(th))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}TouchTest.App.Redraw()},Redraw:function(){var $t,h;System.Console.Write(System.Linq.Enumerable.from(TouchTest.App._history).count()+" ");TouchTest.App._context.clearRect(0,0,TouchTest.App._canvas.width,TouchTest.App._canvas.height);$t=Bridge.getEnumerator(TouchTest.App._history);try{while($t.moveNext())h=$t.Current,h.Draw(TouchTest.App._context)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}}}});Bridge.define("TouchTest.Item",{props:{Id:0,Dead:!1}});Bridge.define("TouchTest.TouchHistory.Point",{props:{Time:null,ClientX:0,ClientY:0,PageX:0,PageY:0,ScreenX:0,ScreenY:0,RadiusX:0,RadiusY:0,Force:0,RotationAngle:0},ctors:{init:function(){this.Time=System.DateTime.getDefaultValue()},ctor:function(time,t){this.$initialize();this.Time=time;this.ClientX=t.clientX;this.ClientY=t.clientY;this.PageX=t.pageX;this.PageY=t.pageY;this.ScreenX=t.screenX;this.ScreenY=t.screenY;this.RadiusX=t.radiusX;this.RadiusY=t.radiusY;this.Force=t.force;this.RotationAngle=t.rotationAngle}}});Bridge.define("TouchTest.Set$1",function(T){return{inherits:[System.Collections.Generic.IEnumerable$1(T)],fields:{_items:null},alias:["getEnumerator",["System$Collections$Generic$IEnumerable$1$"+Bridge.getTypeAlias(T)+"$getEnumerator","System$Collections$Generic$IEnumerable$1$getEnumerator"]],ctors:{ctor:function(capacity){capacity===void 0&&(capacity=256);this.$initialize();this._items=System.Array.init(capacity,function(){return Bridge.getDefaultValue(T)},T)}},methods:{Add:function(i){for(var j=-1;(j=j+1|0)>=0;)if(this._items[System.Array.index(j,this._items)]==null||this._items[System.Array.index(j,this._items)].Dead){this._items[System.Array.index(j,this._items)]=i;break}},Remove:function(id){for(var j=-1;(j=j+1|0)>=0;){if(this._items[System.Array.index(j,this._items)]==null){while((j=j-1|0)>0&&this._items[System.Array.index(j,this._items)].Dead)this._items[System.Array.index(j,this._items)]=null;break}if(this._items[System.Array.index(j,this._items)].Id===id){if(this._items[System.Array.index(j,this._items)].Dead=!0,this._items[System.Array.index(j=j+1|0,this._items)]==null)while((j=j-1|0)>0&&this._items[System.Array.index(j,this._items)].Dead)this._items[System.Array.index(j,this._items)]=null;break}}},Contains:function(id){return this.Find(id)!=null},Find:function(id){for(var j=-1,q,f;(j=j+1|0)>=0;){if(this._items[System.Array.index(j,this._items)]==null){while((j=j-1|0)>0&&this._items[System.Array.index(j,this._items)].Dead)this._items[System.Array.index(j,this._items)]=null;break}if(this._items[System.Array.index(j,this._items)].Id===id){if(q=this._items[System.Array.index(j,this._items)],j>0&&this._items[System.Array.index(j-1|0,this._items)].Dead){for(f=this._items[System.Array.index(j+1|0,this._items)]==null,f?this._items[System.Array.index(j,this._items)]=null:this._items[System.Array.index(j,this._items)].Dead=!0;(j=j-1|0)>0&&this._items[System.Array.index(j,this._items)].Dead;)f?this._items[System.Array.index(j,this._items)]=null:this._items[System.Array.index(j,this._items)].Dead=!0;this._items[System.Array.index(j+1|0,this._items)]=q;this._items[System.Array.index(j+1|0,this._items)].Dead=!1}return q}}return null},getEnumerator:function(){var $step=0,j,$async_e,$enumerator=new(Bridge.GeneratorEnumerator$1(T))(Bridge.fn.bind(this,function(){try{for(;;)switch($step){case 0:j=-1;$step=1;continue;case 1:if((j=j+1|0)>=0){$step=2;continue}$step=8;continue;case 2:if(this._items[System.Array.index(j,this._items)]==null){$step=3;continue}$step=4;continue;case 3:return!1;case 4:if(!this._items[System.Array.index(j,this._items)].Dead){$step=5;continue}$step=7;continue;case 5:return $enumerator.current=this._items[System.Array.index(j,this._items)],$step=6,!0;case 6:$step=7;continue;case 7:$step=1;continue;case 8:default:return!1}}catch($async_e1){$async_e=System.Exception.create($async_e1);throw $async_e;}}));return $enumerator},System$Collections$IEnumerable$getEnumerator:function(){return Bridge.getEnumerator(Bridge.cast(this,System.Collections.Generic.IEnumerable$1(T)),T)}}}});Bridge.define("TouchTest.TouchHistory",{inherits:[TouchTest.Item],fields:{_events:null},ctors:{init:function(){this._events=new(System.Collections.Generic.List$1(TouchTest.TouchHistory.Point))}},methods:{AddEvent:function(t){var now=System.DateTime.getNow();this._events.add(new TouchTest.TouchHistory.Point(now,t))},Draw:function(context){var $t,e;if(this._events.Count>1){context.moveTo(this._events.getItem(0).ClientX,this._events.getItem(0).ClientY);$t=Bridge.getEnumerator(System.Linq.Enumerable.from(this._events).skip(1));try{while($t.moveNext())e=$t.Current,context.lineTo(e.ClientX,e.ClientY)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}context.stroke()}}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJUb3VjaFRlc3QubWluLmpzIiwKICAic291cmNlUm9vdCI6ICIiLAogICJzb3VyY2VzIjogW10sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIiIsCiAgInNvdXJjZXNDb250ZW50IjogW10KfQo=
